<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ritmo — Smart Payment Router</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ── Header ──────────────────────────────────────────────────────────── -->
  <header class="header">
    <div class="header-left">
      <div class="logo">⚡ Ritmo Payment Router</div>
      <span id="sim-status-badge" class="badge badge-idle">Idle</span>
    </div>
    <div class="header-right">
      <button id="btn-start" class="btn btn-primary" onclick="toggleSimulation()">
        ▶ Start Simulation
      </button>
    </div>
  </header>

  <!-- ── Metrics bar ─────────────────────────────────────────────────────── -->
  <section class="metrics-bar">
    <div class="metric">
      <span class="metric-value" id="m-total">0</span>
      <span class="metric-label">Transactions</span>
    </div>
    <div class="metric">
      <span class="metric-value metric-green" id="m-auth-rate">—</span>
      <span class="metric-label">Auth Rate</span>
    </div>
    <div class="metric">
      <span class="metric-value metric-amber" id="m-declined">0</span>
      <span class="metric-label">Declined</span>
    </div>
    <div class="metric">
      <span class="metric-value metric-red" id="m-failed">0</span>
      <span class="metric-label">Errors</span>
    </div>
    <div class="metric">
      <span class="metric-value metric-blue" id="m-cost-saved">$0.00</span>
      <span class="metric-label">Cost Saved</span>
    </div>
    <div class="metric">
      <span class="metric-value" id="m-latency">0ms</span>
      <span class="metric-label">Avg Latency</span>
    </div>
    <div class="metric">
      <span class="metric-value" id="m-tps">0.0</span>
      <span class="metric-label">TPS</span>
    </div>
  </section>

  <!-- ── Main content ────────────────────────────────────────────────────── -->
  <main class="main">

    <!-- ── Left column ────────────────────────────────────────────────────── -->
    <div class="left-col">

      <!-- Processor cards -->
      <section class="processors-section">
        <h2 class="section-title">Payment Processors</h2>
        <div class="processor-grid" id="processor-grid">
          <!-- Cards injected by JS -->
        </div>
      </section>

      <!-- Routing distribution chart -->
      <section class="routing-section">
        <h2 class="section-title">Routing Distribution — 15s window</h2>
        <div id="routing-rows">
          <!-- Rows injected by JS -->
        </div>
      </section>

      <!-- Auth rate trend chart -->
      <section class="chart-section">
        <h2 class="section-title">Auth Rate Trend — 60s window</h2>
        <!--
          ViewBox: 0 0 500 120
          Chart area: left=30, top=8, right=492, bottom=100
          H=92, W=462
          85% reference line: y = 8 + (1-0.85)*92 = 21.8 ≈ 22
        -->
        <svg id="trend-svg" viewBox="0 0 500 120" preserveAspectRatio="none" class="trend-chart"
             role="img" aria-label="Auth rate trend over last 60 seconds">
          <!-- Grid lines -->
          <line x1="30" y1="8"   x2="30"  y2="100" stroke="#2d3148" stroke-width="1"/>
          <line x1="30" y1="100" x2="492" y2="100" stroke="#2d3148" stroke-width="1"/>
          <!-- 85% reference line -->
          <line x1="30" y1="22" x2="492" y2="22"
                stroke="#6b7280" stroke-width="0.8" stroke-dasharray="4,3"/>
          <!-- Y-axis labels -->
          <text x="24" y="12"  fill="#6b7280" font-size="8" text-anchor="end">100%</text>
          <text x="24" y="25"  fill="#6b7280" font-size="7" text-anchor="end">85%</text>
          <text x="24" y="102" fill="#6b7280" font-size="8" text-anchor="end">0%</text>
          <!-- X-axis label -->
          <text x="261" y="116" fill="#6b7280" font-size="8" text-anchor="middle">← 60s ago · now →</text>
          <!-- Dynamic elements (#trend-area, #trend-line) injected by JS -->
        </svg>
        <div class="chart-legend">
          <span class="legend-line"></span><span>Auth rate</span>
          <span class="legend-dash"></span><span>85% target</span>
        </div>
      </section>

      <!-- Threshold config panel -->
      <section class="config-section">
        <h2 class="section-title">
          Threshold Configuration
          <button class="btn btn-sm btn-ghost" onclick="toggleThresholdPanel()">Edit</button>
        </h2>
        <div id="threshold-panel" class="threshold-panel hidden">
          <div class="threshold-row">
            <label>Window (ms)</label>
            <input type="number" id="cfg-window" class="cfg-input" value="15000" min="5000" max="60000" step="1000" />
          </div>
          <div class="threshold-row">
            <label>Degraded below (%)</label>
            <input type="number" id="cfg-degraded" class="cfg-input" value="92" min="50" max="99" step="1" />
          </div>
          <div class="threshold-row">
            <label>Down below (%)</label>
            <input type="number" id="cfg-down" class="cfg-input" value="75" min="10" max="90" step="1" />
          </div>
          <button class="btn btn-primary btn-sm" onclick="saveThresholds()">Save</button>
          <span id="cfg-saved-msg" class="cfg-saved hidden">✓ Saved</span>
        </div>
      </section>

    </div><!-- /left-col -->

    <!-- ── Right column: transaction feed ─────────────────────────────────── -->
    <div class="right-col">
      <section class="feed-section">
        <div class="feed-header">
          <h2 class="section-title" style="margin-bottom:0">Live Transaction Feed</h2>
          <div class="feed-filter-btns">
            <button class="btn btn-sm btn-ghost active" id="filter-all" onclick="setFeedFilter(0)">All</button>
            <button class="btn btn-sm btn-ghost" id="filter-30m" onclick="setFeedFilter(1800000)">30m</button>
            <button class="btn btn-sm btn-ghost" id="filter-15m" onclick="setFeedFilter(900000)">15m</button>
            <button class="btn btn-sm btn-ghost" id="filter-5m"  onclick="setFeedFilter(300000)">5m</button>
          </div>
        </div>
        <div class="feed" id="tx-feed">
          <div class="feed-empty">Waiting for transactions…</div>
        </div>
      </section>
    </div>

  </main>

  <script src="app.js"></script>
</body>
</html>
